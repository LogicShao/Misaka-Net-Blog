---
// Misaka Network - 分页组件
// 支持跳转到任意页面的分页导航

export interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string;
}

const {currentPage, totalPages, baseUrl} = Astro.props;

// 生成页码数组，显示当前页附近的页码
function generatePageNumbers(current: number, total: number): (number | string)[] {
  const pages: (number | string)[] = [];

  // 总是显示第一页
  pages.push(1);

  if (total <= 7) {
    // 总页数少于7，显示所有页码
    for (let i = 2; i <= total; i++) {
      pages.push(i);
    }
  } else {
    // 总页数多于7，使用省略号
    if (current <= 3) {
      // 当前页在前面
      for (let i = 2; i <= 4; i++) {
        pages.push(i);
      }
      pages.push('...');
      pages.push(total);
    } else if (current >= total - 2) {
      // 当前页在后面
      pages.push('...');
      for (let i = total - 3; i <= total; i++) {
        pages.push(i);
      }
    } else {
      // 当前页在中间
      pages.push('...');
      for (let i = current - 1; i <= current + 1; i++) {
        pages.push(i);
      }
      pages.push('...');
      pages.push(total);
    }
  }

  return pages;
}

const pageNumbers = generatePageNumbers(currentPage, totalPages);

// 构建页面URL
function getPageUrl(page: number): string {
  if (page === 1) {
    return baseUrl;
  }
  return `${baseUrl}/${page}`;
}

const hasPrevPage = currentPage > 1;
const hasNextPage = currentPage < totalPages;
---

<nav class="pagination-container" aria-label="分页导航">
  <div class="pagination-wrapper">
    <!-- 上一页按钮 -->
    {hasPrevPage ? (
      <a
        href={getPageUrl(currentPage - 1)}
        class="pagination-button pagination-prev"
        aria-label="上一页"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        <span class="hidden sm:inline">上一页</span>
      </a>
    ) : (
      <span class="pagination-button pagination-prev pagination-disabled" aria-disabled="true">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        <span class="hidden sm:inline">上一页</span>
      </span>
    )}

    <!-- 页码列表 -->
    <div class="pagination-pages">
      {pageNumbers.map((pageNum) => (
        pageNum === '...' ? (
          <span class="pagination-ellipsis">...</span>
        ) : (
          <a
            href={getPageUrl(pageNum as number)}
            class={`pagination-page ${pageNum === currentPage ? 'pagination-page-active' : ''}`}
            aria-label={`第 ${pageNum} 页`}
            aria-current={pageNum === currentPage ? 'page' : undefined}
          >
            {pageNum}
          </a>
        )
      ))}
    </div>

    <!-- 下一页按钮 -->
    {hasNextPage ? (
      <a
        href={getPageUrl(currentPage + 1)}
        class="pagination-button pagination-next"
        aria-label="下一页"
      >
        <span class="hidden sm:inline">下一页</span>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </a>
    ) : (
      <span class="pagination-button pagination-next pagination-disabled" aria-disabled="true">
        <span class="hidden sm:inline">下一页</span>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </span>
    )}
  </div>

  <!-- 页面信息 -->
  <div class="pagination-info">
    <span class="font-mono text-sm" style="color: var(--text-muted);">
      第 <span class="text-misaka-blue font-semibold">{currentPage}</span> 页 / 共 <span
      class="text-misaka-circuit font-semibold">{totalPages}</span> 页
    </span>
  </div>
</nav>

<style>
  .pagination-container {
    margin-top: 3rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
  }

  .pagination-wrapper {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
  }

  .pagination-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    color: var(--text-primary);
    font-family: var(--font-mono);
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .pagination-button:hover:not(.pagination-disabled) {
    background-color: rgba(74, 222, 128, 0.1);
    border-color: var(--misaka-circuit);
    color: var(--misaka-circuit);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(74, 222, 128, 0.2);
  }

  .pagination-disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .pagination-pages {
    display: flex;
    gap: 0.25rem;
    align-items: center;
  }

  .pagination-page {
    min-width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    color: var(--text-primary);
    font-family: var(--font-mono);
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .pagination-page:hover {
    background-color: rgba(56, 189, 248, 0.1);
    border-color: var(--misaka-blue);
    color: var(--misaka-blue);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(56, 189, 248, 0.2);
  }

  .pagination-page-active {
    background: linear-gradient(135deg, var(--misaka-circuit), var(--misaka-blue));
    border-color: transparent;
    color: var(--bg-primary);
    font-weight: 700;
    cursor: default;
    box-shadow: 0 4px 12px rgba(74, 222, 128, 0.3);
  }

  .pagination-page-active:hover {
    transform: none;
  }

  .pagination-ellipsis {
    min-width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    font-family: var(--font-mono);
    font-size: 0.875rem;
  }

  .pagination-info {
    padding: 0.75rem 1.5rem;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    text-align: center;
  }

  /* 响应式设计 */
  @media (max-width: 640px) {
    .pagination-button {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
    }

    .pagination-page {
      min-width: 2rem;
      height: 2rem;
      font-size: 0.75rem;
    }

    .pagination-pages {
      gap: 0.125rem;
    }

    .pagination-info {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }
  }

  /* 动画效果 */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .pagination-container {
    animation: fadeIn 0.5s ease;
  }
</style>
